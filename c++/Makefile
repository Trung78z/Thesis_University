# Variables
TARGET           := detection
TEST_TARGET		 := test
ENGINE           := models/30-6.engine
VIDEO_INPUT      := videos/test_video_640x640.mp4
# VIDEO_INPUT      := ../services/tool/video/40xZVEFVBuE.mp4
BUILD_DIR        := build
BIN_DIR          := bin
CMAKE_BUILD_TYPE ?= Release

# Default target
.PHONY: all run build clean rebuild debug

all: run

run: build
	@echo "üöÄ Running $(TARGET) with video input..."
	@$(BIN_DIR)/$(TARGET) --engine $(ENGINE) --video $(VIDEO_INPUT) || echo "‚ùå Program failed"

build:
	@echo "üîß Building project..."
	@cmake -B $(BUILD_DIR) -S . -DCMAKE_BUILD_TYPE=$(CMAKE_BUILD_TYPE)
	@cmake --build $(BUILD_DIR) --target $(TARGET) -- -j$(shell nproc)

build_test:
	@echo "üîß Building project..."
	@cmake -B $(BUILD_DIR) -S . -DCMAKE_BUILD_TYPE=$(CMAKE_BUILD_TYPE)
	@cmake --build $(BUILD_DIR) --target $(TEST_TARGET) -- -j$(shell nproc)

rebuild: clean build

test: build_test
	@echo "üöÄ Running $(TEST_TARGET) with video input..."
	@$(BIN_DIR)/$(TEST_TARGET) --engine $(ENGINE) --video $(VIDEO_INPUT) || echo "‚ùå Program failed"

clean:
	@echo "üßπ Cleaning build files..."
	@rm -rf $(BUILD_DIR) $(BIN_DIR)

debug:
	@$(BIN_DIR)/$(TARGET) --help
